{% extends "demo_app/base.html" %}
{% load i18n %}
{% load allauth account socialaccount %}

{% block title %}Sign In · DDBlog{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-sm-10 col-md-7 col-lg-5">

    <!-- Cognito / Social login -->
    {% get_providers as socialaccount_providers %}
    {% if socialaccount_providers %}
    <div class="card border-0 shadow-sm mb-3" style="border-radius:14px">
      <div class="card-body p-4">
        <h5 class="fw-bold mb-3 text-center">
          <i class="bi bi-shield-lock me-2" style="color:var(--accent)"></i>Sign in with
        </h5>
        {% for provider in socialaccount_providers %}
        <a href="{% provider_login_url provider.id process='login' %}"
           class="btn btn-outline-secondary w-100 mb-2 d-flex align-items-center justify-content-center gap-2 py-2">
          {% if provider.id == 'amazon_cognito' %}
          <i class="bi bi-cloud-fill" style="color:#FF9900"></i>
          <span>Amazon Cognito</span>
          {% else %}
          <span>{{ provider.name }}</span>
          {% endif %}
        </a>
        {% endfor %}
      </div>
    </div>
    <div class="text-center text-muted small mb-3">— or sign in with email —</div>
    {% endif %}

    <!-- Email / Password form -->
    <div class="card border-0 shadow-sm" style="border-radius:14px">
      <div class="card-body p-4">
        <h5 class="fw-bold mb-3 text-center">
          <i class="bi bi-envelope me-2" style="color:var(--accent)"></i>Email Sign In
        </h5>

        <form method="POST" action="{% url 'account_login' %}">
          {% csrf_token %}
          {% if redirect_field_value %}
          <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
          {% endif %}

          {% for field in form %}
          <div class="mb-3">
            <label for="{{ field.id_for_label }}" class="form-label fw-semibold" style="font-size:.85rem">
              {{ field.label }}
            </label>
            <input type="{{ field.field.widget.input_type }}"
                   name="{{ field.html_name }}"
                   id="{{ field.id_for_label }}"
                   value="{{ field.value|default:'' }}"
                   class="form-control {% if field.errors %}is-invalid{% endif %}"
                   {% if field.field.required %}required{% endif %}
                   autocomplete="{{ field.html_name }}"/>
            {% for error in field.errors %}
            <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
          </div>
          {% endfor %}

          {% if form.non_field_errors %}
          <div class="alert alert-danger py-2 small">
            {% for error in form.non_field_errors %}{{ error }}{% endfor %}
          </div>
          {% endif %}

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input type="checkbox" name="remember" id="id_remember" class="form-check-input"/>
              <label for="id_remember" class="form-check-label small">{% trans "Remember me" %}</label>
            </div>
            <a href="{% url 'account_reset_password' %}" class="small text-decoration-none" style="color:var(--accent)">
              {% trans "Forgot password?" %}
            </a>
          </div>

          <button type="submit" class="btn w-100 py-2 fw-semibold text-white"
                  style="background:var(--accent);border-radius:8px">
            <i class="bi bi-box-arrow-in-right me-1"></i>{% trans "Sign In" %}
          </button>
        </form>

        <hr class="my-3"/>
        <p class="text-center small mb-0">
          {% trans "Don't have an account?" %}
          <a href="{% url 'account_signup' %}" class="fw-semibold text-decoration-none" style="color:var(--accent)">
            {% trans "Sign Up" %}
          </a>
        </p>
      </div>
    </div>

  </div>
</div>
{% endblock %}
